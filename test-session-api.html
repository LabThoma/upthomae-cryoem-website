<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Session API Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success {
        color: green;
      }
      .error {
        color: red;
      }
      .response {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        white-space: pre-wrap;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        background: #007cba;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      button:hover {
        background: #005a87;
      }
      .form-group {
        margin: 10px 0;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      textarea,
      select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 3px;
      }
      textarea {
        height: 100px;
      }
    </style>
  </head>
  <body>
    <h1>Session API Test</h1>

    <!-- Create Session Form -->
    <div class="test-section">
      <h2>Create New Session</h2>
      <div class="form-group">
        <label>User Name:</label>
        <input type="text" id="userName" value="Test User" />
      </div>
      <div class="form-group">
        <label>Date:</label>
        <input type="date" id="sessionDate" value="2025-08-06" />
      </div>
      <div class="form-group">
        <label>Grid Box Name:</label>
        <input type="text" id="gridBoxName" value="TestBox001" />
      </div>
      <div class="form-group">
        <label>Loading Order:</label>
        <input type="number" id="loadingOrder" value="1" />
      </div>

      <h3>Vitrobot Settings</h3>
      <div class="form-group">
        <label>Humidity (%):</label>
        <input type="number" id="humidity" value="95" step="0.1" />
      </div>
      <div class="form-group">
        <label>Temperature (°C):</label>
        <input type="number" id="temperature" value="4" step="0.1" />
      </div>
      <div class="form-group">
        <label>Blot Force:</label>
        <input type="number" id="blotForce" value="3" step="0.1" />
      </div>
      <div class="form-group">
        <label>Blot Time (seconds):</label>
        <input type="number" id="blotTime" value="4" step="0.1" />
      </div>
      <div class="form-group">
        <label>Wait Time (seconds):</label>
        <input type="number" id="waitTime" value="1" step="0.1" />
      </div>

      <h3>Grid Info</h3>
      <div class="form-group">
        <label>Grid Type:</label>
        <input type="text" id="gridType" value="Quantifoil R1.2/1.3" />
      </div>
      <div class="form-group">
        <label>Grid Batch:</label>
        <input type="text" id="gridBatch" value="Q350CR1.3-01" />
      </div>
      <div class="form-group">
        <label>Glow Discharge Applied:</label>
        <input type="checkbox" id="glowDischarge" />
      </div>

      <h3>Grid Preparations</h3>
      <div class="form-group">
        <label>Sample Name:</label>
        <input type="text" id="sampleName" value="Test Sample 1" />
      </div>
      <div class="form-group">
        <label>Sample Concentration:</label>
        <input type="text" id="sampleConcentration" value="1 mg/ml" />
      </div>
      <div class="form-group">
        <label>Volume (μL):</label>
        <input type="number" id="volume" value="3" step="0.1" />
      </div>
      <div class="form-group">
        <label>Slot Number:</label>
        <input type="number" id="slotNumber" value="1" min="1" max="12" />
      </div>
      <div class="form-group">
        <label>Comments:</label>
        <textarea id="comments">Test grid preparation</textarea>
      </div>

      <button onclick="createTestSession()">Create Session</button>
      <div id="createResult" class="response"></div>
    </div>

    <!-- List Sessions -->
    <div class="test-section">
      <h2>List All Sessions</h2>
      <button onclick="listSessions()">Get Sessions</button>
      <div id="sessionsList" class="response"></div>
    </div>

    <!-- Get Session Details -->
    <div class="test-section">
      <h2>Get Session Details</h2>
      <div class="form-group">
        <label>Session ID:</label>
        <input type="number" id="sessionIdInput" value="1" />
      </div>
      <button onclick="getSessionDetails()">Get Session Details</button>
      <div id="sessionDetails" class="response"></div>
    </div>

    <!-- Update Session -->
    <div class="test-section">
      <h2>Update Session</h2>
      <div class="form-group">
        <label>Session ID to Update:</label>
        <input type="number" id="updateSessionId" value="1" />
      </div>
      <div class="form-group">
        <label>New User Name:</label>
        <input type="text" id="updateUserName" value="Updated User" />
      </div>
      <button onclick="updateTestSession()">Update Session</button>
      <div id="updateResult" class="response"></div>
    </div>

    <script>
      const API_BASE = "/api";

      async function createTestSession() {
        const data = {
          session: {
            user_name: document.getElementById("userName").value,
            date: document.getElementById("sessionDate").value,
            grid_box_name: document.getElementById("gridBoxName").value,
            loading_order: parseInt(
              document.getElementById("loadingOrder").value
            ),
          },
          vitrobot_settings: {
            humidity_percent: parseFloat(
              document.getElementById("humidity").value
            ),
            temperature_c: parseFloat(
              document.getElementById("temperature").value
            ),
            blot_force: parseFloat(document.getElementById("blotForce").value),
            blot_time_seconds: parseFloat(
              document.getElementById("blotTime").value
            ),
            wait_time_seconds: parseFloat(
              document.getElementById("waitTime").value
            ),
            glow_discharge_applied:
              document.getElementById("glowDischarge").checked,
          },
          grid_info: {
            grid_type: document.getElementById("gridType").value,
            grid_batch: document.getElementById("gridBatch").value,
            glow_discharge_applied:
              document.getElementById("glowDischarge").checked,
          },
          grids: [
            {
              sample_name: document.getElementById("sampleName").value,
              sample_concentration: document.getElementById(
                "sampleConcentration"
              ).value,
              volume_ul_override: parseFloat(
                document.getElementById("volume").value
              ),
              slot_number: parseInt(
                document.getElementById("slotNumber").value
              ),
              comments: document.getElementById("comments").value,
              include_in_session: true,
            },
          ],
        };

        try {
          const response = await fetch(`${API_BASE}/sessions`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          document.getElementById("createResult").innerHTML =
            `<span class="${response.ok ? "success" : "error"}">Status: ${
              response.status
            }</span>\n` + JSON.stringify(result, null, 2);
        } catch (error) {
          document.getElementById(
            "createResult"
          ).innerHTML = `<span class="error">Error: ${error.message}</span>`;
        }
      }

      async function listSessions() {
        try {
          const response = await fetch(`${API_BASE}/sessions`);
          const result = await response.json();
          document.getElementById("sessionsList").innerHTML =
            `<span class="${response.ok ? "success" : "error"}">Status: ${
              response.status
            }</span>\n` + JSON.stringify(result, null, 2);
        } catch (error) {
          document.getElementById(
            "sessionsList"
          ).innerHTML = `<span class="error">Error: ${error.message}</span>`;
        }
      }

      async function getSessionDetails() {
        const sessionId = document.getElementById("sessionIdInput").value;
        try {
          const response = await fetch(`${API_BASE}/sessions/${sessionId}`);
          const result = await response.json();
          document.getElementById("sessionDetails").innerHTML =
            `<span class="${response.ok ? "success" : "error"}">Status: ${
              response.status
            }</span>\n` + JSON.stringify(result, null, 2);
        } catch (error) {
          document.getElementById(
            "sessionDetails"
          ).innerHTML = `<span class="error">Error: ${error.message}</span>`;
        }
      }

      async function updateTestSession() {
        const sessionId = document.getElementById("updateSessionId").value;
        const data = {
          session: {
            user_name: document.getElementById("updateUserName").value,
            date: document.getElementById("sessionDate").value,
            grid_box_name:
              document.getElementById("gridBoxName").value + " (Updated)",
            loading_order: 2,
          },
        };

        try {
          const response = await fetch(`${API_BASE}/sessions/${sessionId}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();
          document.getElementById("updateResult").innerHTML =
            `<span class="${response.ok ? "success" : "error"}">Status: ${
              response.status
            }</span>\n` + JSON.stringify(result, null, 2);
        } catch (error) {
          document.getElementById(
            "updateResult"
          ).innerHTML = `<span class="error">Error: ${error.message}</span>`;
        }
      }

      // Load session details in the update form when clicking get details
      async function loadSessionForUpdate() {
        await getSessionDetails();
        // You could parse the result and populate the update fields here
      }
    </script>
  </body>
</html>
